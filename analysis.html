<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tara Chakkithara">
<meta name="author" content="Sean Chua">
<meta name="dcterms.date" content="2024-11-12">

<title>How Toronto Achieved a Historic Decline in Bicycle Theft in 2024</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="analysis_files/libs/quarto-html/quarto.js"></script>
<script src="analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">How Toronto Achieved a Historic Decline in Bicycle Theft in 2024</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Tara Chakkithara </p>
             <p>Sean Chua </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 12, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>In the past decade, cycling has become a prominent mode of transportation in Toronto. By 2019, around 75 percent of households in the city owned a bicycle, and more than 40% of people reported using their bike for non-recreational purposes such as commuting to school or the office <span class="citation" data-cites="cityoftoronto2019cycling">(<a href="#ref-cityoftoronto2019cycling" role="doc-biblioref">City of Toronto 2019</a>)</span>. Despite being the safest city in Canada due to its low crime density <span class="citation" data-cites="mazloum2024ottawa">(<a href="#ref-mazloum2024ottawa" role="doc-biblioref">Mazloum 2024</a>)</span>, bike theft is a significant issue. Between 2010 and 2024, residents of Toronto faced a total financial loss of $33,704,466 CAD from bike theft.</p>
<p>Although 2024 has seen the lowest number of bike thefts since 2013, as shown in <a href="#fig-trends" class="quarto-xref">Figure&nbsp;1</a>, the recovery rate for stolen bikes remains low at 0.7 percent, making bike theft prevention a priority for cyclists. This analysis aims to serve as a preventative guide for Toronto residents and explores the following questions: Why did bike theft drastically increase in 2014? Why did bike thefts experience a historical decline in 2024? What initiatives can Toronto Public Services take to reduce bike theft even more in the future?</p>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div id="fig-trends" class="quarto-float quarto-figure quarto-figure-left anchored" data-fig-align="left">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-trends-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="analysis_files/figure-html/fig-trends-1.png" class="img-fluid quarto-figure quarto-figure-left figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-trends-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Bike Theft in Toronto from 2010 to 2024
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="characteristics-of-stolen-bikes" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Characteristics of Stolen Bikes</h1>
<p>Based on data from <a href="https://data.torontopolice.on.ca/datasets/TorontoPS::bicycle-thefts-open-data/about">Toronto’s Public Safety Data Portal</a>, we determined that Mountain and Regular Bikes are stolen most often. Stolen bikes tend to have an average speed of 21 km/h and a typical market value of around $1,000. Black bikes make up a significant majority of thefts, likely due to their inconspicuous nature, especially at night, as well as their widespread availability in the market. The majority of all bike thefts are tied to other primary offenses, where the bike is either used as a getaway vehicle or stolen opportunistically. Around 44% of thefts are standalone incidents where bike theft is the primary crime as seen in <a href="#fig-primary" class="quarto-xref">Figure&nbsp;2</a>.</p>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div id="fig-primary" class="quarto-float quarto-figure quarto-figure-left anchored" data-fig-align="left">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-primary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="analysis_files/figure-html/fig-primary-1.png" class="img-fluid quarto-figure quarto-figure-left figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-primary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Categories of Bike Theft
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="spatial-distributions-of-bike-theft" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Spatial Distributions of Bike Theft</h1>
<p>As shown in <a href="#fig-neighbourhood" class="quarto-xref">Figure&nbsp;3</a>, the Yonge-Bay Corridor has the highest number of bike thefts in Toronto, with 2,141 recorded thefts since 2010. In contrast, the Maple Leaf area has experienced the fewest thefts, with only 8 incidents over the same period. The Yonge-Bay Corridor is characterized by a population in which 51% are adults aged 25 to 54. The largest income group in the area earns less than 10,000 CAD, accounting for 30% of the population aged 15 and over. Additionally, 98% of residents live in apartments <span class="citation" data-cites="yongebay2016">(<a href="#ref-yongebay2016" role="doc-biblioref">City of Toronto 2016a</a>)</span>. In comparison, Maple Leaf has a population approximately half the size of Yonge-Bay. 46% of its residents live in single-detached homes, and 40% of the working population earns between 20,000 and 50,000 CAD <span class="citation" data-cites="mapleleaf2016">(<a href="#ref-mapleleaf2016" role="doc-biblioref">City of Toronto 2016b</a>)</span>.</p>
<p>According to <a href="#fig-apt" class="quarto-xref">Figure&nbsp;4</a>, apartments are more vulnerable to bike thefts compared to detached homes. Therefore, it is not surprising that the Yonge-Bay Corridor experiences higher rates of bike thefts. Additionally, the potential of selling stolen bicycle parts may provide a significant financial incentive to some residents, given the high levels of poverty in the region.</p>
<p>Bike thefts occur more often near apartments since apartments often have communal bike storage areas which may not be as secure as individual garages in detached homes. In fact, in a 2018 article, it was written that “for the first time since Toronto police began collecting data, the number of bikes stolen from apartments, condos and their private storage rooms has surpassed those stolen on the street <span class="citation" data-cites="aptthefts">(<a href="#ref-aptthefts" role="doc-biblioref">Lysecki 2018</a>)</span>.” Such areas are also easily accessed by multiple residents and increase the chances of theft occurring.</p>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div id="fig-neighbourhood" class="quarto-float quarto-figure quarto-figure-left anchored" data-fig-align="left">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-neighbourhood-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="analysis_files/figure-html/fig-neighbourhood-1.png" class="img-fluid quarto-figure quarto-figure-left figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-neighbourhood-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: The Distribution of Bicycle Thefts Across Toronto Neighbourhoods
</figcaption>
</figure>
</div>
</div>
</div>
<p>From 2010 to 2024, most bike thefts have occurred in outdoor areas, such as parks, hiking trails, and streets. These locations are particularly vulnerable due to the lack of dedicated bike storage infrastructure. In contrast, transit areas and educational institutions experience significantly lower rates of bike theft, as shown in <a href="#fig-apt" class="quarto-xref">Figure&nbsp;4</a>. These areas often offer secure bike racks or lockers, which provide cyclists with a place to lock their bikes. Additionally, these locations tend to attract higher foot traffic, which can deter potential thieves.</p>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div id="fig-apt" class="quarto-float quarto-figure quarto-figure-left anchored" data-fig-align="left">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-apt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="analysis_files/figure-html/fig-apt-1.png" class="img-fluid quarto-figure quarto-figure-left figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-apt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: The Distribution of Bicycle Thefts Across Location Types
</figcaption>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="when-are-bike-thefts-most-prevalent" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> When are Bike Thefts most Prevalent?</h1>
<p>The data shows that bike thefts are more often in urbanized and dense areas where there is both an abundance of bikers and foot traffic. With increased foot traffic, thieves are more easily able to blend in with their surroundings compared to isolated areas; moreover, the sheer number of bikes in urban areas naturally leads to more instances of thefts in general.</p>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div id="fig-hour" class="quarto-float quarto-figure quarto-figure-left anchored" data-fig-align="left">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-hour-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="analysis_files/figure-html/fig-hour-1.png" class="img-fluid quarto-figure quarto-figure-left figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hour-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Density of Bike Thefts By Hour of Day
</figcaption>
</figure>
</div>
</div>
</div>
<p>This being said, from the above figure, we can see that the number of thefts reaches its peak at around 7:00pm. This may be attributed to nighttime hours where there relatively less visibility as well as a more crowded environments, as more people tend to go out during this time. Another factor contributing to this would be the fact that many commuters tend to return from work during this time, leading to a higher volume of parked bikes on streets and other public areas.</p>
</section>
<section id="prevention-is-better-than-cure-report-time-and-recovery-chances" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Prevention is Better than Cure: Report Time and Recovery Chances</h1>
<p>According to the data, it is almost certain that a stolen bike actually remains stolen. More than 97% of reportedly stolen bikes have never been recovered since 2011. It is well-known that the longer one goes without reporting a theft, the higher chance of the item not being recovered; as such, it is vital for one to exercise great caution with taking care of bikes and prevent them from ever being stolen in the first place. Some solutions include using locks with more robust locking mechanisms to prevent easy breakage and access to parked bikes. One can also opt to secure both the frame and at least one wheel to a fixed object to reduce the chances of the entire bike getting stolen.</p>
</section>
<section id="limitations" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Limitations</h1>
<p>Limitations of our analysis arise from the scope and nature of the dataset used. Our analysis is based solely on data related to bike thefts, without incorporating external factors that could offer a more comprehensive understanding of broader crime trends.</p>
<p>For instance, after conducting additional research, we found that bike thefts have been one of the only crimes to show a decline in recent years. In contrast, car theft has increased significantly, with insurance companies covering over 1 billion CAD in claims for car thefts in 2024 alone, as reported by <span class="citation" data-cites="yousif2024">Yousif (<a href="#ref-yousif2024" role="doc-biblioref">2024</a>)</span>. This broader trend of rising vehicle thefts is not reflected in our dataset, which may result in an unrealistic view of crime trends.</p>
<p>Additionally, the declining number of police officers entering the force could impact both the accuracy and consistency of crime reporting. Since 1999, only 37 officers have joined the Toronto Police Service, <span class="citation" data-cites="fanfair2024">Fanfair (<a href="#ref-fanfair2024" role="doc-biblioref">2024</a>)</span>, even as Toronto’s population grew by over 100,000 people in 2023 <span class="citation" data-cites="clayton2024">Clayton (<a href="#ref-clayton2024" role="doc-biblioref">2024</a>)</span>. This disparity between population growth and police staffing may contribute to challenges in crime reporting and response, potentially affecting the reliability of the data.</p>
<p>While our analysis provides valuable insights into bike theft patterns, it does not account for the broader context of rising vehicle thefts or the limitations posed by police staffing and reporting. A more comprehensive analysis would include additional data on other types of crime, law enforcement trends, and demographic changes to paint a more accurate picture of crime dynamics in Toronto.</p>
</section>
<section id="conclusion" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Conclusion</h1>
<p>Toronto has experienced a relatively high amount of bike thefts over the past decade. Due to the nature of this crime, it remains to be a prevalent issue that is typically concentrated in high-density areas, especially in locations with high bicycle ownership. The majority of these are committed by opportunistic thieves who exploit vulnerabilities in bikes, such as unattended bikes secured with weak locks, and generally reside in urban areas. They are also often driven by financial needs or drug dependencies in some cases. Some thieves specifically target bikes in whole or in part — either to sell parts or the entire bike in exchange for the aforementioned incentives. The detection and recovery rates for stolen bikes are typically extremely low; this could partly be attributed to victims being unable to provide sufficient information or evidence about the theft or the thief.</p>
</section>
<section id="references" class="level1 unnumbered" data-number="8">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">8 References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-yongebay2016" class="csl-entry" role="listitem">
City of Toronto. 2016a. <span>“Bay Street Corridor 2016 Profile.”</span> <a href="https://www.toronto.ca/ext/sdfa/Neighbourhood%20Profiles/pdf/2016/pdf1/cpa76.pdf">https://www.toronto.ca/ext/sdfa/Neighbourhood%20Profiles/pdf/2016/pdf1/cpa76.pdf</a>.
</div>
<div id="ref-mapleleaf2016" class="csl-entry" role="listitem">
———. 2016b. <span>“Maple Leaf 2016 Profile.”</span> <a href="https://www.toronto.ca/ext/sdfa/Neighbourhood%20Profiles/pdf/2016/pdf1/cpa29.pdf">https://www.toronto.ca/ext/sdfa/Neighbourhood%20Profiles/pdf/2016/pdf1/cpa29.pdf</a>.
</div>
<div id="ref-cityoftoronto2019cycling" class="csl-entry" role="listitem">
———. 2019. <span>“2019 Cycling Public Opinion Survey.”</span> <a href="https://www.toronto.ca/wp-content/uploads/2021/04/8f76-2019-Cycling-Public-Option-Survey-City-of-Toronto-Cycling.pdf">https://www.toronto.ca/wp-content/uploads/2021/04/8f76-2019-Cycling-Public-Option-Survey-City-of-Toronto-Cycling.pdf</a>.
</div>
<div id="ref-clayton2024" class="csl-entry" role="listitem">
Clayton, Frank. 2024. <span>“Toronto Tops in 2023 Population Growth in Canada and the United States.”</span> <a href="https://www.torontomu.ca/content/dam/centre-urban-research-land-development/BLOG/blog86/CUR_Blog_CAN_US_Population_Blog_June_10_2024_final.pdf">https://www.torontomu.ca/content/dam/centre-urban-research-land-development/BLOG/blog86/CUR_Blog_CAN_US_Population_Blog_June_10_2024_final.pdf</a>.
</div>
<div id="ref-fanfair2024" class="csl-entry" role="listitem">
Fanfair, Ron. 2024. <span>“Unacceptable Risks in Reduced Budget.”</span> <em>Toronto Police Service</em>. <a href="https://www.tps.ca/media-centre/stories/unacceptable-risks-in-reduced-budget/#:~:text=For%20the%20past%2013%20years,complexity%2C%22%20the%20Chief%20said.">https://www.tps.ca/media-centre/stories/unacceptable-risks-in-reduced-budget/#:~:text=For%20the%20past%2013%20years,complexity%2C%22%20the%20Chief%20said.</a>
</div>
<div id="ref-aptthefts" class="csl-entry" role="listitem">
Lysecki, Sarah. 2018. <span>“Condo Boards Need to Start Taking Bike Theft Seriously.”</span> <em>Now Toronto</em>. <a href="https://nowtoronto.com/lifestyle/condo-boards-need-to-start-taking-bike-theft-seriously/">https://nowtoronto.com/lifestyle/condo-boards-need-to-start-taking-bike-theft-seriously/</a>.
</div>
<div id="ref-mazloum2024ottawa" class="csl-entry" role="listitem">
Mazloum, Toula. 2024. <span>“Ottawa-Gatineau Among Safest Cities in Canada: Report.”</span> <em>CTV News Ottawa</em>. <a href="https://ottawa.ctvnews.ca/ottawa-gatineau-top-safest-cities-in-canada-report-1.6905291">https://ottawa.ctvnews.ca/ottawa-gatineau-top-safest-cities-in-canada-report-1.6905291</a>.
</div>
<div id="ref-yousif2024" class="csl-entry" role="listitem">
Yousif, Nadine. 2024. <span>“How Canada Became a Car Theft Capital of the World.”</span> <em>BBC News</em>. <a href="https://www.bbc.com/news/articles/cy79dq2n093o">https://www.bbc.com/news/articles/cy79dq2n093o</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>